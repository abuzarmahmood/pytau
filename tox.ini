[tox]
envlist = py312
isolated_build = True

[testenv]
deps =
    pytest
    pymc==5.16.2
    numpyro==0.15.1
    arviz==0.18.0
    graphviz==0.20.3
    pytest-cov
    nbmake
commands =
    pytest {posargs:tests/} --cov=pytau --cov-report=term-missing

[testenv:notebooks]
deps =
    pytest
    pymc==5.16.2
    numpyro==0.15.1
    arviz==0.18.0
    graphviz==0.20.3
    nbmake
commands =
    # Test working notebooks only (skip problematic ones)
    pytest --nbmake pytau/how_to/examples/Bayesian_Changepoint_Model.ipynb
    pytest --nbmake pytau/how_to/model_demos/CategoricalChangepoint2D_demo.ipynb
    pytest --nbmake pytau/how_to/model_demos/GaussianChangepointMean2D_demo.ipynb
    pytest --nbmake pytau/how_to/model_demos/GaussianChangepointMeanDirichlet_demo.ipynb
    pytest --nbmake pytau/how_to/model_demos/AllTastePoisson_demo.ipynb
    pytest --nbmake pytau/how_to/model_demos/SingleTastePoisson_demo.ipynb
    pytest --nbmake pytau/how_to/model_demos/GaussianChangepointMeanVar2D_demo.ipynb

[pytest]
testpaths = tests
python_files = test_*.py
python_functions = test_*
markers =
    slow: marks tests as slow (deselect with '-m "not slow"')
    notebook: marks tests as notebook tests
